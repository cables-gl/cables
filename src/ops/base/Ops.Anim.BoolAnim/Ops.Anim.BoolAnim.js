var anim=new CABLES.Anim();

const
    exe=op.inTrigger("exe"),
    bool=op.inValueBool("bool"),
    pease=anim.createPort(op,"easing"),
    duration=op.inValue("duration",0.5),
    dir=op.inValueSelect("Direction",["Animate Both","Only True","Only False"],"Both"),
    valueFalse=op.inValue("value false",0),
    valueTrue=op.inValue("value true",1),
    next=op.outTrigger("trigger"),
    value=op.outValue("value"),
    finished=op.outValueBool("finished"),
    finishedTrigger=op.outTrigger("Finished Trigger");


var startTime=CABLES.now();
op.toWorkPortsNeedToBeLinked(exe);
op.setPortGroup("Animation",[duration,pease]);
op.setPortGroup("Values",[valueFalse,valueTrue]);

dir.onChange=bool.onChange=valueFalse.onChange=valueTrue.onChange=duration.onChange=setAnim;
setAnim();


function setAnim()
{
    finished.set(false);
    var now=(CABLES.now()-startTime)/1000;
    var oldValue=anim.getValue(now);
    anim.clear();

    anim.setValue(now,oldValue);


    if(!bool.get())
    {
        if(dir.get()!='Only True' ) anim.setValue(now+duration.get(),valueFalse.get());
            else anim.setValue(now,valueFalse.get());
    }
    else
    {
        if(dir.get()!='Only False' ) anim.setValue(now+duration.get(),valueTrue.get());
            else anim.setValue(now,valueTrue.get());

    }
}


exe.onTriggered=function()
{
    var t=(CABLES.now()-startTime)/1000;
    value.set(anim.getValue(t));

    if(anim.hasEnded(t))
    {
        if(!finished.get()) finishedTrigger.trigger();
        finished.set(true);
    }

    next.trigger();
};

